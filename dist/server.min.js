"use strict";var express=require("express"),_require=require("mongodb"),MongoClient=_require.MongoClient,ServerApiVersion=_require.ServerApiVersion,cors=require("cors"),app=express();app.use(cors()),app.use(express.json()),app.use(express.static("public"));var uri="mongodb+srv://dticona1038:t1c0m4n09@cluster0.mh56n.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0",client=new MongoClient(uri,{serverApi:{version:ServerApiVersion.v1,strict:!0,deprecationErrors:!0}});app.get("/api/databases",function(e,r){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(client.connect());case 3:return e.next=5,regeneratorRuntime.awrap(client.db().admin().listDatabases());case 5:t=e.sent,r.json(t.databases),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r.status(500).json({error:e.t0.message});case 12:case"end":return e.stop()}},null,null,[[0,9]])}),app.get("/api/collections/:dbName",function(r,t){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(client.connect());case 3:return n=client.db(r.params.dbName),e.next=6,regeneratorRuntime.awrap(n.listCollections().toArray());case 6:a=e.sent,t.json(a),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),t.status(500).json({error:e.t0.message});case 13:case"end":return e.stop()}},null,null,[[0,10]])}),app.get("/api/data/:dbName/:collectionName",function(r,t){var n,a,s,o,i,c,p,u,l,m;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(client.connect());case 3:if(n=client.db(r.params.dbName),a=n.collection(r.params.collectionName),s=r.query,o=s.day,i=s.month,c=s.year,p={},u=null,c&&i&&o?(u={gestion:parseInt(c),mes:parseInt(i),dia:parseInt(o)},p=u):(c&&(p.gestion=parseInt(c)),i&&(p.mes=parseInt(i)),o&&(p.dia=parseInt(o))),console.log("Filtro aplicado:",p),u)return e.next=13,regeneratorRuntime.awrap(a.find({$or:[{gestion:u.gestion,mes:u.mes,dia:{$lte:u.dia}},{gestion:u.gestion,mes:{$lt:u.mes}},{gestion:{$lt:u.gestion}}]}).sort({gestion:-1,mes:-1,dia:-1}).limit(10).toArray());e.next=17;break;case 13:m=e.sent,l=m,e.next=20;break;case 17:return e.next=19,regeneratorRuntime.awrap(a.find(p).sort({gestion:-1,mes:-1,dia:-1}).limit(10).toArray());case 19:l=e.sent;case 20:t.json(l),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),console.error("Error en la consulta:",e.t0),t.status(500).json({error:e.t0.message});case 27:case"end":return e.stop()}},null,null,[[0,23]])});var PORT=process.env.PORT||5e3;app.listen(PORT,function(){console.log("Server running on port ".concat(PORT))});
//# sourceMappingURL=server.min.js.map
